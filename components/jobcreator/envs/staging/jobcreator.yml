---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: jobcreator
  namespace: fia
spec:
  template:
    spec:
      serviceAccountName: jobcreator
      containers:
        - name: jobcreator
          image: ghcr.io/fiaisis/jobcreator@sha256:0e11ff647f522ea253ca9bcac3a667a095b006e67a15943c66f1c4e543c337c6
          readinessProbe:
            exec:
              command:
                - sh
                - -c
                - |
                  CURRENT_TIME=$(date +%s)
                  FILE_TIME=$(date -r /tmp/heartbeat +%s)
                  DIFF=$((CURRENT_TIME - FILE_TIME))
                  if [ $DIFF -lt 20 ]; then
                    exit 0
                  else
                    exit 1
                  fi
            initialDelaySeconds: 10
            periodSeconds: 10
          livenessProbe:
            exec:
              command:
                - sh
                - -c
                - |
                  CURRENT_TIME=$(date +%s)
                  FILE_TIME=$(date -r /tmp/heartbeat +%s)
                  DIFF=$((CURRENT_TIME - FILE_TIME))
                  if [ $DIFF -lt 20 ]; then
                    exit 0
                  else
                    exit 1
                  fi
            initialDelaySeconds: 10
            failureThreshold: 3
            periodSeconds: 10
          env:
            - name: WATCHER_SHA
              value: 7d601eee4bb2c2e27593ce11d091539daeeb2e90b0dd33fc808cd335a67c3fbc
